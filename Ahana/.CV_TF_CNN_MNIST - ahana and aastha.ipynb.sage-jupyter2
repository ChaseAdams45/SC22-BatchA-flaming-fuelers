{"backend_state":"ready","kernel":"cv_env","kernel_state":"idle","kernel_usage":{"cpu":0,"memory":0},"metadata":{"accelerator":"GPU","colab":{"collapsed_sections":[],"name":"CV Classification.ipynb","provenance":[]},"interpreter":{"hash":"08210294964727e4010dccc398c44f22b92a2e77e2aceea574ad21eae77cd8e8"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.8"}},"trust":true,"type":"settings"}
{"cell_type":"code","exec_count":2,"id":"16be43","input":"import tensorflow as tf\nfrom tensorflow import keras","metadata":{"id":"ptEQDylSP4SP"},"pos":2,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":35,"id":"5d023e","input":"# parameters\ninput_shape = (28, 28) # the image is 28x28\nnum_classes = 10 # 10 labels\nnum_epochs = 5 # 5 training iterations, we bump this down because the model takes longer to train\n\n# TODO You can change to the numbers MNIST dataset if you'd like to see how it works on different images\nfashion_mnist = tf.keras.datasets.fashion_mnist\n(train_images, train_labels), (test_images, test_labels) = fashion_mnist.load_data()\n\nclass_names = (\"T-shirt/top\", \"Trouser\", \"Pullover\", \"Dress\", \"Coat\",\n           \"Sandal\", \"Shirt\", \"Sneaker\", \"Bag\", \"Ankle boot\")\n\n# 60,000 images with each image being 28 by 28 pixels\ntrain_images.shape","metadata":{"id":"Zd-szzHtHCYb"},"output":{"0":{"data":{"text/plain":"(60000, 28, 28)"},"exec_count":35,"output_type":"execute_result"}},"pos":4,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":36,"id":"cbb5d3","input":"train_images[0]","output":{"0":{"data":{"text/plain":"array([[  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   1,\n          0,   0,  13,  73,   0,   0,   1,   4,   0,   0,   0,   0,   1,\n          1,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   3,\n          0,  36, 136, 127,  62,  54,   0,   0,   0,   1,   3,   4,   0,\n          0,   3],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,\n          0, 102, 204, 176, 134, 144, 123,  23,   0,   0,   0,   0,  12,\n         10,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0, 155, 236, 207, 178, 107, 156, 161, 109,  64,  23,  77, 130,\n         72,  15],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   0,\n         69, 207, 223, 218, 216, 216, 163, 127, 121, 122, 146, 141,  88,\n        172,  66],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   1,   1,   0,\n        200, 232, 232, 233, 229, 223, 223, 215, 213, 164, 127, 123, 196,\n        229,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n        183, 225, 216, 223, 228, 235, 227, 224, 222, 224, 221, 223, 245,\n        173,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n        193, 228, 218, 213, 198, 180, 212, 210, 211, 213, 223, 220, 243,\n        202,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   1,   3,   0,  12,\n        219, 220, 212, 218, 192, 169, 227, 208, 218, 224, 212, 226, 197,\n        209,  52],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   6,   0,  99,\n        244, 222, 220, 218, 203, 198, 221, 215, 213, 222, 220, 245, 119,\n        167,  56],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   4,   0,   0,  55,\n        236, 228, 230, 228, 240, 232, 213, 218, 223, 234, 217, 217, 209,\n         92,   0],\n       [  0,   0,   1,   4,   6,   7,   2,   0,   0,   0,   0,   0, 237,\n        226, 217, 223, 222, 219, 222, 221, 216, 223, 229, 215, 218, 255,\n         77,   0],\n       [  0,   3,   0,   0,   0,   0,   0,   0,   0,  62, 145, 204, 228,\n        207, 213, 221, 218, 208, 211, 218, 224, 223, 219, 215, 224, 244,\n        159,   0],\n       [  0,   0,   0,   0,  18,  44,  82, 107, 189, 228, 220, 222, 217,\n        226, 200, 205, 211, 230, 224, 234, 176, 188, 250, 248, 233, 238,\n        215,   0],\n       [  0,  57, 187, 208, 224, 221, 224, 208, 204, 214, 208, 209, 200,\n        159, 245, 193, 206, 223, 255, 255, 221, 234, 221, 211, 220, 232,\n        246,   0],\n       [  3, 202, 228, 224, 221, 211, 211, 214, 205, 205, 205, 220, 240,\n         80, 150, 255, 229, 221, 188, 154, 191, 210, 204, 209, 222, 228,\n        225,   0],\n       [ 98, 233, 198, 210, 222, 229, 229, 234, 249, 220, 194, 215, 217,\n        241,  65,  73, 106, 117, 168, 219, 221, 215, 217, 223, 223, 224,\n        229,  29],\n       [ 75, 204, 212, 204, 193, 205, 211, 225, 216, 185, 197, 206, 198,\n        213, 240, 195, 227, 245, 239, 223, 218, 212, 209, 222, 220, 221,\n        230,  67],\n       [ 48, 203, 183, 194, 213, 197, 185, 190, 194, 192, 202, 214, 219,\n        221, 220, 236, 225, 216, 199, 206, 186, 181, 177, 172, 181, 205,\n        206, 115],\n       [  0, 122, 219, 193, 179, 171, 183, 196, 204, 210, 213, 207, 211,\n        210, 200, 196, 194, 191, 195, 191, 198, 192, 176, 156, 167, 177,\n        210,  92],\n       [  0,   0,  74, 189, 212, 191, 175, 172, 175, 181, 185, 188, 189,\n        188, 193, 198, 204, 209, 210, 210, 211, 188, 188, 194, 192, 216,\n        170,   0],\n       [  2,   0,   0,   0,  66, 200, 222, 237, 239, 242, 246, 243, 244,\n        221, 220, 193, 191, 179, 182, 182, 181, 176, 166, 168,  99,  58,\n          0,   0],\n       [  0,   0,   0,   0,   0,   0,   0,  40,  61,  44,  72,  41,  35,\n          0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0],\n       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,\n          0,   0]], dtype=uint8)"},"exec_count":36,"output_type":"execute_result"}},"pos":6,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":37,"id":"6d07fa","input":"train_images = train_images.reshape((60000,28,28,1))\n# This just has a massive output, if you want to see the new shape, uncomment it and run this block\n# train_images[0]","pos":8,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":38,"id":"37e580","input":"test_images = test_images.reshape((10000, 28, 28, 1))","pos":10,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":39,"id":"f988d0","input":"import matplotlib.pyplot as plt\nimport numpy as np\n\ndef show_imgs():\n    plt.figure(figsize=(10,10))\n    for i in range(25):\n        # Create a 5x5 grid of pictures, place current picture in the grid\n        plt.subplot(5,5,i+1)\n        # Remove the x and y ticks\n        plt.xticks([])\n        plt.yticks([])\n        # Disable the grid in each picture, we dont want x/y axis for these\n        plt.grid(False)\n        plt.imshow(train_images[i], cmap=plt.cm.binary)\n        plt.xlabel(class_names[train_labels[i]])\n    plt.show()","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":112},"id":"s2DfOJeRLbwk","outputId":"961e9441-4b66-42ac-8fd1-068e580efcf1"},"pos":12,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":40,"id":"651309","input":"show_imgs()","output":{"0":{"data":{"image/png":"e734e5f33e8ed7708cb6e1498bdf20f89463c435","text/plain":"<Figure size 720x720 with 25 Axes>"},"output_type":"display_data"}},"pos":13,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":41,"id":"5e96fc","input":"# The parameters in each of these Conv2D layers are as follows:\n# layers.Conv2D(Output_size, Stride, activation, input_shape)\n# Stride is just how far the square of relevant pixels moves between layers. \n# Simply put, for this model, the model looks at a 4x4 square of pixels and\n# then moves 4 pixels to the left before checking the next 4x4 box of pixels\ndef create_model():\n    model = keras.models.Sequential()\n    model.add(keras.layers.Conv2D(28, (3, 3), activation='relu', input_shape=(28, 28, 1)))\n    # Max Pooling just grabs the largest number in a specified area and uses that for the whole area\n    # below we are looking at a 2x2 square and using the largest number in that square as the value for the whole square\n\n    model.add(keras.layers.MaxPooling2D((2, 2)))\n    model.add(keras.layers.Conv2D(56, (3, 3), activation='relu'))\n\n    model.add(keras.layers.MaxPooling2D((2, 2)))\n    model.add(keras.layers.Conv2D(56, (3, 3), activation='relu'))\n    \n    model.add(keras.layers.Flatten())\n    model.add(keras.layers.Dense(64, activation='relu'))\n    model.add(keras.layers.Dense(10))\n\n    return model","metadata":{"id":"UslclwUyIU6p"},"pos":16,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":42,"id":"93e504","input":"model = create_model()\n# The optimizer is just an algorithm that helps the AI learn faster\n# The loss is Sparse Categorical Crossentropy, the name is scary but it just means that \n# the outputs are converted to percentages and then compared to the expected output\n# Metrics = accuracy means that we only care about how close the answer was to the actual answer \nmodel.compile(optimizer='adam',\n              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True),\n              metrics=['accuracy'])\nmodel.summary()","metadata":{"id":"83YcVBTMNkE0"},"output":{"0":{"name":"stdout","output_type":"stream","text":"Model: \"sequential_10\"\n_________________________________________________________________\nLayer (type)                 Output Shape              Param #   \n=================================================================\nconv2d_30 (Conv2D)           (None, 26, 26, 28)        280       \n_________________________________________________________________\nmax_pooling2d_20 (MaxPooling (None, 13, 13, 28)        0         \n_________________________________________________________________\nconv2d_31 (Conv2D)           (None, 11, 11, 56)        14168     \n_________________________________________________________________\nmax_pooling2d_21 (MaxPooling (None, 5, 5, 56)          0         \n_________________________________________________________________\nconv2d_32 (Conv2D)           (None, 3, 3, 56)          28280     \n_________________________________________________________________\nflatten_10 (Flatten)         (None, 504)               0         \n_________________________________________________________________\ndense_20 (Dense)             (None, 64)                32320     \n_________________________________________________________________\ndense_21 (Dense)             (None, 10)                650       \n=================================================================\nTotal params: 75,698\nTrainable params: 75,698\nNon-trainable params: 0\n_________________________________________________________________\n"}},"pos":17,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":43,"id":"1011fc","input":"model.fit(train_images, train_labels, epochs=num_epochs)","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Jm4C52vBNxBi","outputId":"7c1ac7da-1d31-483c-ff84-63eccb56d49b"},"output":{"0":{"name":"stdout","output_type":"stream","text":"Epoch 1/5\n1875/1875 [==============================] - 24s 13ms/step - loss: 0.5616 - accuracy: 0.8178\nEpoch 2/5\n1875/1875 [==============================] - 24s 13ms/step - loss: 0.3511 - accuracy: 0.8715\nEpoch 3/5\n1875/1875 [==============================] - 24s 13ms/step - loss: 0.3132 - accuracy: 0.8852\nEpoch 4/5\n1875/1875 [==============================] - 23s 12ms/step - loss: 0.2904 - accuracy: 0.8919\nEpoch 5/5\n1875/1875 [==============================] - 22s 12ms/step - loss: 0.2679 - accuracy: 0.9009\n"},"1":{"data":{"text/plain":"<tensorflow.python.keras.callbacks.History at 0x19da5103220>"},"exec_count":43,"output_type":"execute_result"}},"pos":20,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":44,"id":"107b9c","input":"test_loss, test_accuracy = model.evaluate(test_images, test_labels)\n\nprint(f'Accuracy = {test_accuracy} on {test_images.shape[0]} images')","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"I6XAn4mNr8_W","outputId":"3a47fecd-91ad-4274-ef90-beb63ee1d07e"},"output":{"0":{"name":"stdout","output_type":"stream","text":"313/313 [==============================] - 1s 4ms/step - loss: 0.3352 - accuracy: 0.8844\nAccuracy = 0.8844000101089478 on 10000 images\n"}},"pos":23,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":45,"id":"49efb4","input":"predictions = model.predict(test_images)","pos":25,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":72,"id":"52ada1","input":"import random\nrand = random.randint(0,9999)\n\nplt.subplot()\nplt.axis('off')\nplt.imshow(test_images[rand], cmap=plt.cm.binary)\nplt.show()\n\nprediction = np.argmax(predictions[rand])\nactual = class_names[test_labels[rand]]\nprint(f'Our model predicted: {class_names[prediction]}')\nprint(f'The actual answer was: {actual}')","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":265},"id":"Ra_kXL0EV2vf","outputId":"d91906ff-bf30-4466-b6c1-c3f63ec80dd3"},"output":{"0":{"data":{"image/png":"5bfc0300fe8893e34f5b6ac6ef6b3ce8f97cc1b3","text/plain":"<Figure size 432x288 with 1 Axes>"},"metadata":{"needs_background":"light"},"output_type":"display_data"},"1":{"name":"stdout","output_type":"stream","text":"Our model predicted: T-shirt/top\nThe actual answer was: T-shirt/top\n"}},"pos":28,"state":"done","type":"cell"}
{"cell_type":"code","exec_count":82,"id":"a4a0e2","input":"# pred = model.predict(np.array(test_images[0]))\ntest_images[0].shape\nnp.array(test_images[0]).shape","output":{"0":{"data":{"text/plain":"(28, 28, 1)"},"exec_count":82,"output_type":"execute_result"}},"pos":26,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"118d5c","input":"<h1>Getting the Environment Set Up</h1>","pos":0,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"11d7ed","input":"Each image is represented by a 2-D array where each number in the list represents the brightness of the pixel","pos":5,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"143923","input":"We will also need to do this for our test images","pos":9,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"1c0563","input":"We will be using tensorflow to create and use our neural networks. Throughout this notebook, we will see just how easy it is to make a working neural network that has a surprisingly high accuary!","metadata":{"id":"qAQI1JtBH6NX"},"pos":1,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"1e9a7e","input":"But those numbers don't really show the whole story. For example, we do not know which images it is struggling on specifically. To show off our model and give us a chance to see where it is struggling, we will show an image and make a prediction on it. First, we're going to make predictions on the entire test dataset to show off later","pos":24,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"1f9bc7","input":"That wall of numbers isn't very easy to understand to our brains however. Lets go ahead and display a few of the images from the dataset with matplotlib. If you want to read more about matplot lib, you can go here: https://matplotlib.org/stable/users/index","pos":11,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"213b8f","input":"Now, we'll generate a random number and use it to show off the corresponding image, prediction and actual label. This allows us to re-run this block over and over to see a range of predictions","pos":27,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"403d8b","input":"<h1>Training our Model</h1>","metadata":{"id":"S4nlQyOVNmkk"},"pos":18,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"5c72e0","input":"<h1>Evaluating our Model</h1>","pos":21,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"788104","input":"Evaluating out model with tensorflow is super easy. We can see blow that we were able to get about a 90% accuracy on images that our model has never seen before!","pos":22,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"7af9ec","input":"Tensorflow lets us create a model super easily. A \"Dense\" layer is just a layer that is fully connected to the next layer, this is the basic type of layer that we are familiar with. Then all we need to do is specify how many neurons there should be in the given layer and tensorflow figures out the rest.","pos":15,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"b098b4","input":"For our CNN model, we will need this to be a 3-D array for it to work with tensorflow properly. Below we will reshape it to be 3D and then print it out again","pos":7,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"dc5fbc","input":"Tensorflow makes training easy. All we need to do is give it the input data and the expected outputs with the number of epochs to train for and it will handle the rest!","pos":19,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"faaf69","input":"<h1>Managing our Images</h1>","pos":3,"state":"done","type":"cell"}
{"cell_type":"markdown","id":"fc064e","input":"<h1>Creating Our Model</h1>","pos":14,"state":"done","type":"cell"}
{"id":0,"time":1655237871755,"type":"user"}
{"last_load":1655237861625,"type":"file"}